<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Antqueee</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
      <!-- style css -->
	  <link rel="stylesheet" type="text/css" href="css/loginstyle.css">
      
      <link rel="stylesheet" type="text/css" href="css/style.css">
      <link rel="stylesheet" type="text/css" href="css/productdetail.css">
      
      
       
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <!-- owl stylesheets --> 
           <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>      
	<script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>
	<style>
/* Style for the overlay background */
.overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1;
}

/* Style for the modal box */
.custom-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 300px; /* Adjust the width as needed */
  background-color: #fff;
  padding: 20px;
  border: 1px solid #ddd;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  z-index: 2;
}

.modal-content {
  text-align: center;
}

.close {
  cursor: pointer;
}

  
</style>
</head>
<div>
	<header >
		<!--header section start -->
		<div class="header_section">
		   <div class="container-fluid">
			  <nav class="navbar navbar-expand-lg navbar-light bg-black">
				 <div class="collapse navbar-collapse " id="navbarNav">
			  <div class=><a href="index.html"><img src="images/logo.png"></a></div> 
				 <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"aria-expanded="false" aria-label="Toggle navigation">
				 <span class="navbar-toggler-icon"></span>
				 </button>
				
					<ul class="navbar-nav  ml-auto"> 
					   <li class="nav-item ">
						  <a class="nav-link  text-white" href="/">Home</a>
					   </li>
					   <li class="nav-item ">
						  <a class="nav-link text-white" href="/productlists">Products</a>
					   </li>
					   <li class="nav-item ">
						  <a class="nav-link  text-white" href="/orders?intent=orders">Orders</a>
					   </li>
					   <li class="nav-item ">
						  <a class="nav-link  text-white" href="/cartPage?intent=cart"><i class="fa fa-shopping-cart"></i> <span class="badge"  ></span></i></a>
					   </li>
					   <li class="nav-item">
						  <a class="nav-link text-white" href="/Whsihlist?intent=whishlist"><i class="fa fa-heart"></i></a>
					   </li>
					   <li class="nav-item">
						  <a class="nav-link text-white" href="/profile?intent=profile"><i class="fa fa-user"></i></a>
					   </li>
					   <li class="nav-item">
						  <a class="nav-link text-white" href="/logout">Logout</a>
					   </li>
					</ul>
				 </div>
			  </nav>
			  
		   </div>
		</div>
	 
		</header>
	  
	  
  

    <div class="pd-wrap" row>
		<div class="container col-md-6 ">
	        <div class="heading-section">
	            <h2>Product Details</h2>
	        </div>
	        <div class="row">
	        	<div class="col-md-3">
	        		<div id="slider" class="owl-carousel product-slider">
						
						<div class="item">
						    <img  id="productImage1" src="<%=imageUrls[0]%>" alt="Card image cap" data-zoom="<%=imageUrls[0]%>" >
						</div>
						<div class="item">-
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
					</div>
					<div id="thumb" class="owl-carousel product-thumb">
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
						<div class="item">
						  	<img src="<%=imageUrls[0]%>" />
						</div>
					</div>
	        	</div>
	        	<div class="col-md-6">
	        		<div class="product-dtl">
        				<div class="product-info">
		        			<div class="product-name"><%=products.name %></div>
		        			<div class="reviews-counter">
							<!--	<div class="rate">
								    <input type="radio" id="str5" name="rate" value="5"/>
								    <label for="" title="text">5 stars</label>
								    <input type="radio" id="str4" name="rate" value="4"  />
								    <label for="" title="text">4 stars</label>
								    <input type="radio" id="str3" name="rate" value="3"  />
								    <label for="" title="text">3 stars</label>
								    <input type="radio" id="str2" name="rate" value="2" />
								    <label for="" title="text">2 stars</label>
								    <input type="radio" id="str1" name="rate" value="1" />
								    <label for="" title="text">1 star</label>
								  </div> -->
								  <span><%=averageRating %>☆</span>
								<span><%=review.length %> Reviews</span>
							</div> 
		        			<div class="product-price-discount"><span>Rs.<%=products.price%></span><span class="line-through"></span></div>
		        		</div>
	        			<p><%=products.description %></p>
	        			<div class="row">
	        				<div class="col-md-6">
								<% if (  products.weight) { %>
									<label for="size">Weight</label>
									<div class="product-name"><%=products.weight %></div>

								<%  } %>
								<!---
	        					<label for="size">Size</label>
								<select id="size" name="size" class="form-control">
									<option>S</option>
									<option>M</option>
									<option>L</option>
									<option>XL</option>
								</select>
							-->
	        				</div>
	        				<div class="col-md-6">
	        					<% if (  products.variations.color) { %>
									<label for="size">Weight</label>
									<div class="product-name"><%=products.variations.color %></div>

								<%  } %>
								
	        				</div>
							
	        					<% if (  products.dimensions) { %>
									<div class="col-md-3">
									<label for="size">Height</label>
									<div class="product-name"><%=products.dimensions.height %></div>
									</div>
									<div class="col-md-3">
									<label for="size">Width</label>
									<div class="product-name"><%=products.dimensions.width %></div>
									</div>
									<div class="col-md-3">
									<label for="size">Length</label>
									<div class="product-name"><%=products.dimensions.length %></div>
                                    </div>
								<%  } %>
								
	        				</div>
	        			</div>
	        			<div class="product-count">
	        				
				         <button class="round-black-btn" id="addToCartButton">Add to Cart</button>
						 	
				         <button class="round-black-btn" id="addTowhislistButton">Add to Whishlist</button>
	        			</form>
						</div>
	        		</div>
	        	</div>

	        <div class="product-info-tabs col-md-6">
		        <ul class="nav nav-tabs" id="myTab" role="tablist">
				  	<li class="nav-item">
				    	<a class="nav-link active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true">Description</a>
				  	</li>
				  	<li class="nav-item">
				    	<a class="nav-link" id="review-tab" data-toggle="tab" href="#review" role="tab" aria-controls="review" aria-selected="false">Reviews (0)</a>
				  	</li>
				</ul>
				<div class="tab-content" id="myTabContent">
				  	<div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
				      <%= products.description %>
				  	</div>
				  	<div class="tab-pane fade" id="review" role="tabpanel" aria-labelledby="review-tab">
				  		<div class="review-heading">REVIEWS</div>
						<% for(i=0;i<review.length;i++) { %>
				  		<p class="mb-20"><%=review[i].name %></p> 
						  <textarea class="form-control"  name=""> <%=review[i].comment %></textarea>
						<% } %>
						<div class="review-heading">Add Comments</div>
				  		<form class="review-form"  method="post" action="/productdetails?productId=<%=products._id %>">
		        			<div class="form-group">
			        			<label>Your rating</label>
			        			<div class="reviews-counter">
									<div class="rate1">
									    <input type="radio" id="star5" name="rating" value="5" />
									    <label for="star5" title="text">5 stars</label>
									    <input type="radio" id="star4" name="rating" value="4" />
									    <label for="star4" title="text">4 stars</label>
									    <input type="radio" id="star3" name="rating" value="3" />
									    <label for="star3" title="text">3 stars</label>
									    <input type="radio" id="star2" name="rating" value="2" />
									    <label for="star2" title="text">2 stars</label>
									    <input type="radio" id="star1" name="rating" value="1" />
									    <label for="star1" title="text">1 star</label>
									</div>
								</div>
							</div>
		        			<div class="form-group">
			        			<label>Your message</label>
			        			<textarea class="form-control" rows="10" name="message"></textarea>
			        		</div>
			        		<div class="row">
				        		<div class="col-md-6">
				        			<div class="form-group">
					        			<input type="text" name="Name" class="form-control" placeholder="Name*" required>
					        		</div>
					        	</div>
				        		<div class="col-md-6">
				        			<div class="form-group">
					        			<input type="email" name="email" class="form-control" placeholder="Email Id*" required>
					        		</div>
					        	</div>
					        </div>
					        <button class="round-black-btn">Submit Review</button>
			        	</form>
						
				  	</div>
				</div>
			</div>
			
			<div style="text-align:center;font-size:14px;padding-bottom:20px;"> <a href="http://iiicons.in/" target="_blank" style="color:#ff5e63;font-weight:bold;"></a></div>
		</div>
	</div>
	<div class="mt-5">
		<%- include('../layouts/footer.ejs') %>
  </div>

	<div class="overlay" id="overlay" onclick="closeModal()"></div>
                  <div id="successModal" class="custom-modal">
                    <div class="modal-content">
                        <div class=><a href="index.html"><img src="images/logo.png"></a></div> 
                     <p id="Message"></p>
                      <span class="close" onclick="closeModal()">ok</span>
                     
                    </div>
                  </div>
              </div>
	<script>
		// Add this script in the OTP verification page
          window.history.pushState(null, null, window.location.href);
        window.onpopstate = function () {
          window.history.pushState(null, null, window.location.href);
          }

         const images = document.querySelectorAll('[data-zoom]');
      const zoom = mediumZoom(images);
      images.forEach(function (img) {
          img.addEventListener('load', function () {
              const canvas = document.createElement("canvas");
              const ctx = canvas.getContext("2d");
              const image = new Image();
              image.src = img.src;

              // Get the width and height of the image
              const width = image.width;
              const height = image.height;

              // Set the canvas dimensions to match the image
              canvas.width = width;
              canvas.height = height;

              // Correct the orientation based on EXIF data
              EXIF.getData(image, function () {
                  const orientation = EXIF.getTag(this, "Orientation");

                  if (orientation >= 5 && orientation <= 8) {
                      // Swap width and height for rotated images
                      canvas.width = height;
                      canvas.height = width;
                  }

                  switch (orientation) {
                      case 2:
                          // Horizontal flip
                          ctx.transform(-1, 0, 0, 1, width, 0);
                          break;
                      case 3:
                          // 180° rotation
                          ctx.transform(-1, 0, 0, -1, width, height);
                          break;
                      case 4:
                          // Vertical flip
                          ctx.transform(1, 0, 0, -1, 0, height);
                          break;
                      case 5:
                          // 90° counter-clockwise and vertical flip
                          ctx.transform(0, 1, 1, 0, 0, 0);
                          break;
                      case 6:
                          // 90° clockwise
                          ctx.transform(0, 1, -1, 0, height, 0);
                          break;
                      case 7:
                          // 90° clockwise and vertical flip
                          ctx.transform(0, -1, -1, 0, height, width);
                          break;
                      case 8:
                          // 90° counter-clockwise
                          ctx.transform(0, -1, 1, 0, 0, width);
                          break;
                      default:
                          // Normal orientation
                          ctx.transform(1, 0, 0, 1, 0, 0);
                  }
              });

              // Draw the image on the canvas with corrected orientation
              ctx.drawImage(image, 0, 0, width, height);

              // Replace the image source with the canvas data
              img.src = canvas.toDataURL("image/jpeg");
          });
      });


	document.getElementById('addToCartButton').addEventListener('click', function() {
		const productId=`<%=products._id%>`;
		fetch(`/add-to-cart?id=${productId}`, {
		  method: 'post',
		  headers: {
			'Content-Type': 'application/json',
		  }
	})
		.then(response => {
			console.log(response)
			return response.json()})
		.then(data => {
			console.log(data)
			if(data.cartData){
			const successModal = document.getElementById('successModal');
                const successMessage = document.getElementById('Message');
                successModal.style.display = 'block';
                successMessage.innerHTML="Added to cart Successfully";
                successMessage.style.color="green"
			}
			else{
				const successModal = document.getElementById('successModal');
                const successMessage = document.getElementById('Message');
                successModal.style.display = 'block';
                successMessage.innerHTML=data.message;
                successMessage.style.color="green"
			}
		
		})
		.catch(error =>{
		const successModal = document.getElementById('successModal');
                const successMessage = document.getElementById('Message');
                successModal.style.display = 'block';
                successMessage.innerHTML="InternalServerError";
                successMessage.style.color="red";
	
	  });
	  
	});
	document.getElementById('addTowhislistButton').addEventListener('click', function() {
		const productId=`<%=products._id%>`;
		fetch(`/add-to-whishlist?id=${productId}`, {
		  method: 'post',
		  headers: {
			'Content-Type': 'application/json',
		  }
	})
		.then(response => {
			console.log(response)
			return response.json()})
		.then(data => {
			console.log(data)
			if(data.success){
			const successModal = document.getElementById('successModal');
                const successMessage = document.getElementById('Message');
                successModal.style.display = 'block';
                successMessage.innerHTML="Added to whislist Successfully";
                successMessage.style.color="green"
			}
			else{
				const successModal = document.getElementById('successModal');
                const successMessage = document.getElementById('Message');
                successModal.style.display = 'block';
                successMessage.innerHTML="Cant add to wishlist";
                successMessage.style.color="green"
			}
		
		})
		.catch(error =>{
		const successModal = document.getElementById('successModal');
                const successMessage = document.getElementById('Message');
                successModal.style.display = 'block';
                successMessage.innerHTML="InternalServerError";
                successMessage.style.color="red";
	
	  });
	  
	});



    function closeModal() {
    const successModal = document.getElementById('successModal');
	const successMessage = document.getElementById('Message');
    successModal.style.display = 'none';
      if(successMessage.textContent==="Added to cart Successfully")
	  {
        window.location.href="/cartPage";
	  }
	  else  if(successMessage.textContent==="Added to  whislist Successfully")
	  {
		window.location.href="/whishlist";
	  }
    }



	</script>
    <script src="js/productdetails.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="	sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>